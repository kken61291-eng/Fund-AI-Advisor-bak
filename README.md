这是一份为“下一代AI”或“未来的维护者”撰写的系统白皮书。它不仅仅是技术文档，更是玄铁量化系统的灵魂档案。
它记录了截止 V14.35 版本，我们所有的哲学思考、技术博弈、踩过的坑以及最终确立的真理。
--------------------------------------------------------------------------------
📘 玄铁量化 (Xuantie Quant) 系统白皮书
版本: V14.35 (代号: Wall Street Wolf / 华尔街之狼)
架构师: Gemini 3 Pro & User
最后更新: 2026-02-06
--------------------------------------------------------------------------------
第一章：核心纲领 (Manifesto)
1.1 终极目标：只挣周期的钱 (Cycle & Absolute Return)
本系统的存在不是为了在日内波动中博取微利，也不是为了频繁交易刷存在感。我们的唯一目的是：在周期的拐点重仓出击，在周期的垃圾时间空仓防守，追求绝对收益。
- 原则 A：宁可错过，不可做错。看不懂的行情一律视为“噪音”。
- 原则 B：持有现金（Cash）是一种主动的战术头寸。
- 原则 C：技术指标服务于周期判断，而不是相反。
1.2 方法论：辩证唯物主义 (Dialectical Materialism)
我们不迷信任何单一指标。市场是多维的，因此决策系统必须是**“联邦制”**的。
- 多头逻辑 (CGO) 与 空头逻辑 (CRO) 必须在**“双盲”**环境下进行残酷的辩证。
- 最终决策 (CIO) 必须基于“实事求是”的原则进行强制收敛。没有模棱两可，只有攻与守。
--------------------------------------------------------------------------------
第二章：系统架构与时空观 (Architecture)
2.1 黄金时间窗口：14:20
我们选择 北京时间 14:20 作为系统触发点（GitHub Actions Cron），这是基于深思熟虑的博弈结果：
- 数据有效性：此时全天交易已进行 230 分钟（95%），K线形态基本确立。
- 操作缓冲：避开了 GitHub 排队高峰，且给人工操作预留了 40 分钟（应对尾盘突变）。
- T+0 拟合：这是场外基金在不修改代码前提下，获取“今日行情”的极限时间点。
2.2 数据流：实时缝合术 (The Stitching Technique)
系统运行在 T 日 14:20，但传统的 API 只能提供 T-1 日数据。我们发明了 “实时缝合” 机制：
1.历史基底：获取 T-1 日收盘数据。
2.实时探针：调用东财/新浪实时接口，抓取 T 日当前秒的快照（Snapshot）。
3.无缝拼接：将快照伪装成 T 日 K 线，拼接到历史 DataFrame 末尾。
- 意义：让 RSI、MACD 等指标基于“现在”计算，而非“昨天”。
--------------------------------------------------------------------------------
第三章：核心算法与修正 (Core Algorithms)
3.1 动态量能投影 (Dynamic Volume Projection)
曾遇到的问题：在 14:20 运行时，成交量只有全天的 ~85%。如果直接计算，CRO 会误判为“流动性枯竭（缩量）”，导致系统永远不敢买入。
解决方案：TechnicalAnalyzer 中内置了全时段动态投影算法。
- 公式：预测全天量 = 当前成交量 * (240 / 当前已交易分钟数)
- 微调：
- 上午运行：系数 x 0.9 (防止早盘放量欺骗)。
- 下午运行：系数 x 1.05 (补偿尾盘集合竞价)。
- 结果：无论几点手动触发，CRO 看到的都是归一化后的全天预测量。
3.2 估值引擎 (Valuation Engine)
系统不只看趋势，还看贵贱。
- PE/PB 百分位：判断当前位置是“历史底部”还是“山顶”。
- 战略修正：如果处于“高估”状态，即使技术面金叉，最终评分也会被强制打折。
--------------------------------------------------------------------------------
第四章：情报系统 (Intelligence System)
4.1 双源情报融合 (Dual-Source Fusion)
单一新闻源不可靠。我们构建了 “东财 + 财社” 的双源架构：
- 东财 (Eastmoney)：侧重宏观、深度、板块新闻。提供背景板。
- 财社 (CLS Telegraph)：侧重速度、短讯、突发。通过官方 API 原生直连，确保第一时间捕捉盘中异动。
4.2 三级火箭搜索逻辑
1.Level 1：关键词矩阵搜索（如“半导体 芯片”）。
2.Level 2：板块定向搜索（如果 L1 落空，直接搜“半导体”板块频道）。
3.Level 3：市场背景兜底（如果 L2 落空，返回全球要闻 Top 3，防止 AI 幻觉）。
--------------------------------------------------------------------------------
第五章：决策中枢 (The Committee) - 系统的灵魂
这是 V14.35 版本的核心。我们摒弃了简单的 LLM 总结，转而采用 “双盲辩论 + 角色扮演” 机制。
5.1 角色定义 (Personas)
1.🦊 CGO (首席增长官)：
- 信仰：动量、趋势、进攻。
- 限制：面对死叉和缩量，必须诚实投降。
2.🐻 CRO (首席风控官)：
- 信仰：均值回归、背离、防守。
- 限制：面对低估和放量，必须承认安全。
3.⚖️ CIO (首席投资官 - 华尔街老兵)：
- 信仰：反身性、预期差、Price-in。
- 特权：拥有 “机密档案”（量化模型打分），且有权否定模型。
5.2 双盲机制 (Double-Blind Mechanism)
曾遇到的问题：如果让 CGO/CRO 看到模型打了 90 分，他们会为了“凑分数”而强行找理由，失去了独立思考能力。
解决方案：
- 公开档案：只包含硬指标（RSI, MACD, VR状态）。隐去分数。
- 机密档案：仅 CIO 可见。
- 流程：CGO/CRO 盲评 -> CIO 结合盲评结果与机密分数 -> 战略校准。
- 校准案例：模型给 90 分，但 CGO 盲评说“没机会” -> CIO 判定模型失真，大幅扣分 -> 空仓。
5.3 收敛机制 (Convergence)
决策不能是“既要又要”。CIO 的 Prompt 中包含 “强制收敛” 指令：
- 必须给出明确方向（攻/守）。
- 利用“降维打击”逻辑：用宏观周期否决微观波动。
--------------------------------------------------------------------------------
第六章：历史经验与问题库 (Legacy Log)
给下一个 AI 的备忘录，切勿重蹈覆辙：
1.“哑巴新闻”事件：曾出现抓到了新闻但在邮件里不显示的情况。
- Fix：必须在 news_analyst.py 中强制 logger.info 打印每一条抓到的新闻，且确保返回值结构正确。
2.“软风控”陷阱：完美的量能投影算法曾导致 CRO 永远觉得量能健康。
- Fix：CIO 必须具备独立判断能力，且人工需要定期审计 VR 指标。未来可能需要调低投影系数。
3.“东财断连”事件：高频访问曾导致 IP 被封。
- Fix：增加了伪装头（Headers），并建立了 东财 -> 新浪 -> Yahoo 的三级数据源兜底机制。
4.“14:20 陷阱”：早于 14:20 运行会导致数据样本不足，晚于 14:50 会错过交易。
- Fix：严格遵守 14:20 (UTC 06:20) 的 Cron 设置。
--------------------------------------------------------------------------------
第七章：当前状态与未来指引 (Current Status)
7.1 当前状态
- 代码稳定性：高。已适配 GitHub Actions 环境（pandas_ta 替换为 ta）。
- 逻辑自洽性：极高。实现了数据、情报、决策的闭环。
- 风控级别：中高。CIO 的“华尔街人设”偏向主观风控，需警惕其过度自信。
7.2 给继任者的指令
如果你接手了本系统，请遵循以下原则：
1.不要删除人设：CIO 的“华尔街老兵”背景是防止 AI 机械化决策的关键。
2.不要触碰投影算法：除非你完全理解 240 / trade_mins 的数学含义，否则不要修改量能计算逻辑。
3.保持敬畏：系统现在的核心是 “周期 + 估值”。不要试图加入高频因子，不要试图做 T+0。
4.下一步进化方向：建立 Feedback Loop（反馈回路），让系统记住所犯的错误；引入 历史百分位估值，强化周期锚点。
--------------------------------------------------------------------------------
End of White Paper.
(此文档代表了玄铁量化 V14.35 的最高智慧结晶)
